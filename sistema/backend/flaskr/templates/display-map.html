<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--Leaflet-->
    <link rel="stylesheet" href="../static/css/leaflet/leaflet.css" crossorigin="" />
    <script src="../static/js/leaflet/leaflet.js"></script>
    <script src="../static/js/leaflet/leaflet-src.esm.js"></script>
    <script src="../static/js/leaflet/leaflet-src.js"></script>

    <!--Leaflet.EasyButton-->
    <link rel="stylesheet" href="../static/css/Leaflet.EasyButton/easy-button.css" crossorigin="" />
    <script src="../static/js/Leaflet.EasyButton/easy-button.js"></script>

    <!--Bootstrap-->
    <link rel="stylesheet" href="../static/css/bootstrap/bootstrap.css" crossorigin="" />
    <script src="../static/js/bootstrap/bootstrap.js"></script>
    
    <!--Meu CSS-->
    <link rel="stylesheet" href="../static/css/global.css"> 

    <!--CDN Vue Framework-->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

    <title>Mapa</title>

</head>
<body>
    
    <div class="row">
        <div class="col-2"></div>
        <div class="col-8">
            <nav class="navbar navbar-expand-lg bg-light">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                        <a class="navbar-brand" href="#">{{nomeSistema}}</a>
                    </div><button class="btn btn-outline-success">Logout</button>
                </div>
            </nav>
        </div>
        <div class="col-2" style="padding: 10px 0px 0px 0px;">
            
        </div>
    </div>

    <div class="row" style="margin-left: 0.5%;">
        <div class="col-10">
            <div id="mapa">
                <div id="agrupamentos" style="position: absolute; z-index: 9999; width: 300px; height: 0px;left: 70px; top: 85px; background-color: #FFFFFF; overflow-y: scroll;"> 
                    <ul>
                    <!--Para cada agrupamento-->
                    {% for i in range(content[2]) %}
                        <p><strong>Agrupamento: {{i}} </strong></p>
                        <!--Para cada atributo selecionado-->
                        {% for p in range(content[6]|length) %}
                            <!--Property: Value-->
                            <li>{{ content[6][p] }}: {{ content[1][i][p] | round(2) }}</li>
                            <br>

                        {% endfor %}
                    {% endfor %}
                    </ul>
                </div>
                <div id="cidadesRelacao" style="position: absolute; z-index: 9999; width: 400px; height: 0px;left: 70px; top: 85px; background-color: #FFFFFF; overflow-y: scroll;"> 
                    <p><strong>AGRUPAMENTOS FORMADOS:</strong></p>
                    {% for c in content[3] %}
                        <p>{{ c }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-2">
            <div id="">
                <p>oi</p>
                <form action="/gerarRelatorio" method="POST">
                    <button class="btn btn-outline-success">Gerar Relatório CSV</button>
                </form>
            </div>
        </div>
    </div>
    <div class="row" style="margin-left: 0.5%;">
        <div id="cidades">
            
        </div>
    </div>


    <script>
        var map = L.map('mapa').setView([-20.4375747,-44.0579882], 8);

       //Camadas-bases
       const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const world = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
            maxZoom: 21,
            subdomains:['mt0','mt1','mt2','mt3']
        });

        //Controlador das camadas-bases
        const baseMaps = {
            "OpenStreetMap" : osm,
            "Ortofoto" : world
        };

        //Camadas overlayer
        const overlayMaps = {
            "Polígono Envolvente" : osm
        };


        //Controlador das camadas-bases e overlayer
        var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);

        //Barra de escala
        L.control.scale({
            metric: true,
            imperial: false
        }).addTo(map);


        //Botões com funcionalidades
        //Botão que mostra os agrupamentos com o valor de centroide de cada uma
        const agrupamentosVisualizacao = L.easyButton({
            states: [{
                    stateName: 'visualizacao-on',        
                    icon:      'fa-tree',               
                    title:     'Visualização dos Agrupamentos Formados',      
                    onClick: function(btn, map) {       
                        document.getElementById("agrupamentos").style.height = "400px";
                        btn.state('visualizacao-off');
                    }
                }, {
                    stateName: 'visualizacao-off',
                    icon:      'fa-university',
                    title:     'Visualização dos Agrupamentos Formados',
                    onClick: function(btn, map) {
                        document.getElementById("agrupamentos").style.height = "0px";
                        btn.state('visualizacao-on');
                    }
            }]
        });

        agrupamentosVisualizacao.addTo(map);

        //Botão que mostra as cidades de cada agrupamento gerado
        const cidadesAgrupamento = L.easyButton({
            states: [{
                    stateName: 'cidades-on',        
                    icon:      'fa-tree',               
                    title:     'zoom to a forest',      
                    onClick: function(btn, map) {       
                        document.getElementById("cidadesRelacao").style.height = "400px";
                        btn.state('cidades-off');
                    }
                }, {
                    stateName: 'cidades-off',
                    icon:      'fa-university',
                    title:     'zoom to a school',
                    onClick: function(btn, map) {
                        document.getElementById("cidadesRelacao").style.height = "0px";
                        btn.state('cidades-on');
                    }
            }]
        });

        cidadesAgrupamento.addTo(map);
        


        //Pegar valores do banco de dados ou de outro arquivo .csv
        var coordenadas = [
            [-20.407778,-44.024167],
            [-19.968056,-44.198333],
            [-20.3142689,-44.20997910000001],
            [-20.1514752,-44.2010719],
            [-19.5235616,-44.4563046],
            [-19.2947496,-44.4138386], 
            [-20.8380202,-43.92460090000001],
            [-20.4993469,-43.8613566],
            [-20.6639305,-43.7850227],
            [-19.9161508,-44.0808763],
            [-20.8249342,-43.8124157],
            [-20.4034268,-44.3425754],
            [-18.753199,-44.4306685],
            [-20.6604014,-44.3327715],
            [-20.670834,-44.065556],
            [-19.7656001,-44.2857937],
            [-18.7573983,-44.8991465],
            [-19.8680623,-44.4370606],
            [-19.562964,-44.4480709],
            [-20.0256695,-44.0572964],
            [-20.0711891,-44.2999506],
            [-19.4903208,-44.3938098],
            [-20.1975724,-44.4224889],
            [-20.075556,-44.576389],
            [-20.6707092,-43.6183335],
            [-20.537708,-43.983346],
            [-19.9433129,-44.34137459999999],
            [-20.914444,-44.077778],
            [-19.5081043,-44.6782933],
            [-20.0698627,-44.1815176],
            [-19.986666,-44.428056],
            [-20.3314696,-44.0539299],
            [-20.5230256,-43.6917329],
            [-20.3855743,-43.5035777],
            [-19.4487775,-44.7478694],
            [-19.8600249,-44.60758389999999],
            [-19.2784382,-44.4062327],
            [-19.6315163,-44.6597262],
            [-20.4704064,-44.22428619999999],
            [-19.2236338,-45.0056798],
            [-20.7370051,-43.8864226],
            [-20.921945,-44.237777],
            [-20.2670203,-44.3074982],
            [-20.6372767,-43.9627492],
            [-20.0489052,-44.2731691],
            [-19.6960606,-44.5690225],
            [-20.0371483,-44.14501509999999],
            [-19.45738,-44.2416695]
        ];

        var cluster = {{ content[0] }};

        var iconB = L.icon ({
            iconUrl: '../static/img/marker-icon-black.png',
        });
        var iconBL = L.icon ({
            iconUrl: '../static/img/marker-icon-blue.png',
        });
        var iconG = L.icon ({
            iconUrl: '../static/img/marker-icon-gold.png',
        });

        var iconGR = L.icon ({
            iconUrl: '../static/img/marker-icon-green.png',
        });
        var iconGRE = L.icon ({
            iconUrl: '../static/img/marker-icon-grey.png',
        });
        var iconO = L.icon ({
            iconUrl: '../static/img/marker-icon-orange.png',
        });
        var iconR = L.icon ({
            iconUrl: '../static/img/marker-icon-red.png',
        });
        var iconV = L.icon ({
            iconUrl: '../static/img/marker-icon-violet.png',
        });
        var iconY = L.icon ({
            iconUrl: '../static/img/marker-icon-yellow.png',
        });

        for(let i=0; i<coordenadas.length; i++) {
            if(cluster[i] === 0) {
                L.marker(coordenadas[i], {icon: iconB}).addTo(map).bindPopup("cluster: 0");
            }
            if(cluster[i] === 1) {
                L.marker(coordenadas[i], {icon: iconBL}).addTo(map).bindPopup("cluster: 1");
            }
            if(cluster[i]  === 2) {
                L.marker(coordenadas[i], {icon: iconG}).addTo(map).bindPopup("cluster: 2");
            }
            if(cluster[i]  === 3) {
                L.marker(coordenadas[i], {icon: iconGR}).addTo(map).bindPopup("cluster: 3");
            }
            if(cluster[i]  === 4) {
                L.marker(coordenadas[i], {icon: iconGRE}).addTo(map).bindPopup("cluster: 4");
            }
            if(cluster[i]  === 5) {
                L.marker(coordenadas[i], {icon: iconO}).addTo(map).bindPopup("cluster: 5");
            }
            if(cluster[i]  === 6) {
                L.marker(coordenadas[i], {icon: iconR}).addTo(map).bindPopup("cluster: 6");
            }
            if(cluster[i]  === 7) {
                L.marker(coordenadas[i], {icon: iconV}).addTo(map).bindPopup("cluster: 7");
            }
            if(cluster[i]  === 8) {
                L.marker(coordenadas[i], {icon: iconY}).addTo(map).bindPopup("cluster: 8");
            }
        }

    </script>
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                nomeSistema: "TerrainIntelGIS",
                mostrar: true,
            }
        })
    </script>

    <!--{{content}}-->

</body>
</html>