<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--Configuração-->
    <script src="../static/conf/edit.js"></script>

    <!--Leaflet-->
    <link rel="stylesheet" href="../static/css/leaflet/leaflet.css" crossorigin="" />
    <script src="../static/js/leaflet/leaflet.js"></script>
    <script src="../static/js/leaflet/leaflet-src.esm.js"></script>
    <script src="../static/js/leaflet/leaflet-src.js"></script>

    <!--Leaflet.EasyButton-->
    <link rel="stylesheet" href="../static/css/Leaflet.EasyButton/easy-button.css" crossorigin="" />
    <script src="../static/js/Leaflet.EasyButton/easy-button.js"></script>

    <!--Bootstrap-->
    <link rel="stylesheet" href="../static/css/bootstrap/bootstrap.css" crossorigin="" />
    <script src="../static/js/bootstrap/bootstrap.js"></script>
    
    <!--Meu CSS-->
    <link rel="stylesheet" href="../static/css/global.css"> 

    <!--CDN Vue Framework-->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

    <title>Mapa</title>

</head>
<body>
    
    <div class="row">
        <div class="col-12">

            <nav class="navbar navbar-expand-lg bg-body-tertiary">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">TerrainIntelGIS</a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    <div class="collapse navbar-collapse" id="navbarText">
                      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <form action="/gerarRelatorio" method="POST">
                                <button class="nav-link active">Gerar Relatório PDF</button>
                            </form>
                        </li>
                      </ul>
                      <button class="btn btn-outline-success">Logout</button>
                    </div>
                </div>
            </nav>

        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div id="agrupamentos"> 
                <ul>
                <p><strong>MÉDIAS DOS ATRIBUTOS:</strong></p>
                <!--Para cada agrupamento-->
                {% for i in range(name.centroide|length) %}
                    <p><strong>Agrupamento: {{i+1}} </strong></p>
                    <!--Para cada atributo selecionado-->
                    {% for p in range(name.propriedades_selecionadas|length) %}
                        <!--Property: Value-->
                        <li class="list-group-item">{{ name.propriedades_selecionadas[p] }}: {{ name.centroide[i][p] | round(2) }}</li>
                    {% endfor %}
                    <br>
                {% endfor %}
                </ul>
            </div>
            <div id="cidadesRelacao"> 
                <br>
                <ul>
                    <p><strong>CIDADES POR AGRUPAMENTOS:</strong></p>
                    {% for c in name.cidades_agrupamentos %}
                        <p><strong>Agrupamento: {{loop.index}}</strong></p>
                        <li class="list-group-item">{{ c }}</li> 
                        <br>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="col-md-9">
            <div id="mapa">
            </div>
        </div>
    </div>
    <div class="row">
        <p>Heatmap</p>
    </div>

    <script>
        var map = L.map('mapa').setView([mapa.long, mapa.lat], mapa.zoom);

       //Camadas-bases
       const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const world = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
            maxZoom: 21,
            subdomains:['mt0','mt1','mt2','mt3']
        });

        //Controlador das camadas-bases
        const baseMaps = {
            "OpenStreetMap" : osm,
            "Ortofoto" : world
        };

        //Camadas overlayer
        const overlayMaps = {
            "Polígono Envolvente" : osm
        };


        //Controlador das camadas-bases e overlayer
        var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);

        //Barra de escala
        L.control.scale({
            metric: true,
            imperial: false
        }).addTo(map);

        const coordenadas = coordinates;
        
        var cluster = {{ name.agrupamentos }};

        var iconB = L.icon ({
            iconUrl: '../static/img/marker-icon-black.png',
        });
        var iconBL = L.icon ({
            iconUrl: '../static/img/marker-icon-blue.png',
        });
        var iconG = L.icon ({
            iconUrl: '../static/img/marker-icon-gold.png',
        });

        var iconGR = L.icon ({
            iconUrl: '../static/img/marker-icon-green.png',
        });
        var iconGRE = L.icon ({
            iconUrl: '../static/img/marker-icon-grey.png',
        });
        var iconO = L.icon ({
            iconUrl: '../static/img/marker-icon-orange.png',
        });
        var iconR = L.icon ({
            iconUrl: '../static/img/marker-icon-red.png',
        });
        var iconV = L.icon ({
            iconUrl: '../static/img/marker-icon-violet.png',
        });
        var iconY = L.icon ({
            iconUrl: '../static/img/marker-icon-yellow.png',
        });

        for(let i=0; i<coordenadas.length; i++) {
            if(cluster[i] === 0) {
                L.marker(coordenadas[i], {icon: iconB}).addTo(map).bindPopup("cluster: 0");
            }
            if(cluster[i] === 1) {
                L.marker(coordenadas[i], {icon: iconBL}).addTo(map).bindPopup("cluster: 1");
            }
            if(cluster[i]  === 2) {
                L.marker(coordenadas[i], {icon: iconG}).addTo(map).bindPopup("cluster: 2");
            }
            if(cluster[i]  === 3) {
                L.marker(coordenadas[i], {icon: iconGR}).addTo(map).bindPopup("cluster: 3");
            }
            if(cluster[i]  === 4) {
                L.marker(coordenadas[i], {icon: iconGRE}).addTo(map).bindPopup("cluster: 4");
            }
            if(cluster[i]  === 5) {
                L.marker(coordenadas[i], {icon: iconO}).addTo(map).bindPopup("cluster: 5");
            }
            if(cluster[i]  === 6) {
                L.marker(coordenadas[i], {icon: iconR}).addTo(map).bindPopup("cluster: 6");
            }
            if(cluster[i]  === 7) {
                L.marker(coordenadas[i], {icon: iconV}).addTo(map).bindPopup("cluster: 7");
            }
            if(cluster[i]  === 8) {
                L.marker(coordenadas[i], {icon: iconY}).addTo(map).bindPopup("cluster: 8");
            }
        }

    </script>
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                nomeSistema: "TerrainIntelGIS"
            }
        })
    </script>

    <!--{{name}}-->

</body>
</html>